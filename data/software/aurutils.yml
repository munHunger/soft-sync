name: "aurutils package helper"
# dependencies:
#   - user
settings: &settings
  - path: /etc/pacman.d/aurpkgs
    content: |-
      [options]
      CacheDir = /var/cache/pacman/pkg
      CacheDir = /var/cache/pacman/custom
      CleanMethod = KeepCurrent

      [custom]
      SigLevel = Optional TrustAll
      Server = file:///var/cache/pacman/custom
  # - path: /etc/pacman.conf
  #   content: |-
  #     Include = /etc/pacman.d/custom
  #   position:
  #     type: NON_MANAGED_END
install:
  - |-
    cd /tmp
    git clone https://aur.archlinux.org/aurutils.git
    cd aurutils
    chown -R munhunger ./
    makepkg -sir --noconfirm --skippgpcheck
  - *settings
  - |-
    echo "Include = /etc/pacman.d/custom" >> /etc/pacman.conf
    sudo mkdir -p /var/cache/pacman/aurpkgs
    sudo install -d /var/cache/pacman/aurpkgs -o $USER
    sudo repo-add /var/cache/pacman/aurpkgs/aurpkgs.db.tar
    sudo pacman -S pkgfile --noconfirm
    sudo pkgfile --update
    sudo pkgfile pacconf
    sudo pacman -Syu
uninstall:
  - |-
    sudo pacman -R aur
  - *settings
